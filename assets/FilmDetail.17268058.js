import{_ as e}from"./FilmsBox.049e4d48.js";import t from"./FilmsUpload.c56a1028.js";import{_ as l}from"./main.1da3edb4.js";import{a7 as a,a8 as i,a3 as s,a1 as o,f as n,F as m,J as d,g as c,v as r,p as h,a9 as u,Q as f,i as p}from"./vendor.6d187631.js";const g={data:()=>({email:"1193292553@qq.com",filmDetail:[]}),props:["filmid"],created(){this.getComments()},methods:{getComments(){const e=this.$cloudbase.database();e.command,e.collection("chats").where({filmId:this.filmid,chatFrom:"film",isOk:1}).get().then((e=>{this.filmDetail=e.data,console.log(e.data)}))},formaTime:e=>moment(e).startOf("hour").fromNow(),deleteComment(e){this.$cloudbase.callFunction({name:"shuiteApi",data:{id:e,event:"DELETE_FILM_COMMENT"}}).then((e=>{this.$ElMessage.success({message:"删除成功了!",type:"success"}),this.getComments()})).catch(console.error)}},components:{}},b=u();a("data-v-5bd5e1ab");const v={class:"film-chats boxshadow"},y=c("h3",null,"评论",-1),D={class:"chat-box"},k={class:"chat-box-message"},_=c("span",null,"来自快乐星球",-1),x={class:"message"};i();const C=b(((e,t,l,a,i,u)=>{const f=s("el-empty");return o(),n("div",v,[y,(o(!0),n(m,null,d(i.filmDetail,(e=>(o(),n("div",D,[c("img",{src:"https://q1.qlogo.cn/g?b=qq&nk="+e.email+"&s=640"},null,8,["src"]),c("div",k,[c("p",null,r(e.nickname),1),c("p",null,[c("div",null,[_,c("span",null,r(u.formaTime(e.created)),1)]),c("span",{onClick:t=>u.deleteComment(e._id),class:"chat-delete"},"删除",8,["onClick"])]),c("div",x,r(e.chat),1)])])))),256)),i.filmDetail[0]?h("",!0):(o(),n(f,{key:0,description:"暂无留言..."}))])}));g.render=C,g.__scopeId="data-v-5bd5e1ab";const w={data:()=>({input:""}),props:["filmid"],methods:{submitChat(){const e=this.$auth.currentUser,t=this.$cloudbase.database();t.command,t.collection("chats").add({filmId:this.filmid,chatFrom:"film",chat:this.input,nickname:e.nickName,appVersion:navigator.appVersion,email:e.email,created:Date.now(),updated:Date.now(),isOk:1}).then((e=>{this.$emit("nochat"),this.$ElMessage.success({message:"吐槽成功了!",type:"success"})}))}},components:{}},V=u();a("data-v-cab1d7ae");const F={class:"film-gochat boxshadow"},I=f("提交");i();const T=V(((e,t,l,a,i,m)=>{const d=s("el-input"),r=s("el-button");return o(),n("div",F,[c(d,{placeholder:"吐槽一下吧",modelValue:i.input,"onUpdate:modelValue":t[1]||(t[1]=e=>i.input=e),clearable:"",class:"shuite-search"},null,8,["modelValue"]),c(r,{onClick:m.submitChat,type:"small",style:{height:"40px","margin-left":"10px"}},{default:V((()=>[I])),_:1},8,["onClick"])])}));w.render=T,w.__scopeId="data-v-cab1d7ae";const $={data:()=>({loading:!0,post:null,error:null,cloud:cloudbase.init({env:"yui-7gel1hqtaf6fb79d"}),dialogTableVisible:!1,userAuth:localStorage.getItem("user_auth"),isLoved:!1,textareaStyle:{border:0,padding:0,color:"black"},chating:!1,islogin:!1}),setup:e=>({filmsDetail:p(""),nickname:p("")}),created(){this.cloud.auth({persistence:"local"}),this.getFilmDetail();"EMAIL"==JSON.parse(localStorage.getItem("login_type_yui-7gel1hqtaf6fb79d")).content&&(this.islogin=!0)},methods:{formatterTime:(e,t,l,a)=>moment(l).format("YYYY/MM/DD"),formatterTimeYear:(e,t,l,a)=>moment(e).format("YYYY"),getFilmDetail(){this.$auth.getAuthHeader();const e=this.cloud.database();e.command,e.collection("films").where({_id:this.$route.params.id}).orderBy("created","desc").limit(1).get().then((t=>{this.filmsDetail=t.data[0],e.collection("user").where({_openid:this.filmsDetail._openid}).get().then((t=>{this.nickname=t.data[0].nickname,e.collection("mylove").where({_openid:this.filmsDetail._openid,filmId:this.filmsDetail._id}).get().then((e=>{e.data[0]&&(this.isLoved=!0),setTimeout((()=>{this.loading=!1}),1e3)}))}))}))},getStar(e){const t=this.$auth.getAuthHeader(),a=this.$cloudbase.database();a.command;"ANONYMOUS"==JSON.parse(localStorage.getItem("login_type_yui-7gel1hqtaf6fb79d")).content?l.info("请先登录哦!!!"):a.collection("mylove").where({_openid:t.uid,filmId:e}).get().then((t=>{t.data[0]||a.collection("mylove").add({filmId:e,created:Date.now(),updated:Date.now()}).then((e=>{console.log(e),this.getFilmDetail(),l.success({message:"收藏成功了!",type:"success"})}))}))},delStar(e){const t=this.$auth.getAuthHeader(),a=this.$cloudbase.database();a.command,a.collection("mylove").where({_openid:t.uid,filmId:e}).remove().then((e=>{this.getFilmDetail(),l.success({message:"取消收藏了!",type:"success"})}))},toChat(){this.chating=!0},noChat(){this.chating=!1,this.$refs.comment.getComments()},hideDialog(){this.dialogTableVisible=!1,this.getFilmDetail()}},components:{FilmsBox:e,"films-upload":t,"film-chats":g,"film-gochat":w}},S=u();a("data-v-c94f236e");const j={class:"filmdetail"},Y={style:{padding:"14px"}},q={style:{display:"flex","align-items":"center","justify-items":"space-between","margin-top":"16px",height:"16px"}},M={class:"film-box"},N={class:"film-top"},A={class:"film-message"},L={class:"name"},O=c("span",null,"名称:",-1),E={class:"fclass"},U=c("span",null,"类型:",-1),H={class:"jianjie"},B=c("span",null,"年份:",-1),J={class:"upload-time"},z=c("span",null,"上传时间:",-1),Q={class:"upload-owner"},R=c("span",null,"上传者:",-1),G={class:"rate",style:{display:"flex"}},K=c("span",null,"评分:",-1),P={class:"film-btn"},W=c("i",{class:"el-icon-link"},null,-1),X={class:"film-main"},Z=c("h3",null,"简介",-1),ee=c("h3",null,"推荐理由",-1);i();const te=S(((e,t,l,a,i,d)=>{const u=s("el-skeleton-item"),p=s("el-rate"),g=s("film-gochat"),b=s("el-input"),v=s("film-chats"),y=s("el-skeleton"),D=s("el-space"),k=s("films-upload"),_=s("el-dialog");return o(),n(m,null,[c("div",j,[c(D,{direction:"vertical",alignment:"flex-start",class:"shuite-el-space"},{default:S((()=>[c(y,{rows:15,animated:"",loading:i.loading,class:"shuite-el-skeleton"},{template:S((()=>[c(u,{variant:"image",style:{height:"267px"},class:"shuite-el-skeleton-item"}),c("div",Y,[c(u,{variant:"h3",style:{width:"50%"}}),c("div",q,[c(u,{variant:"text",style:{"margin-right":"16px"}}),c(u,{variant:"text",style:{width:"30%"}})])])])),default:S((()=>[c("div",M,[c("div",N,[a.filmsDetail?(o(),n("img",{key:0,src:a.filmsDetail.tempFileURL},null,8,["src"])):h("",!0),c("div",A,[c("div",L,[O,f(r(a.filmsDetail.name),1)]),c("div",E,[U,f(r(a.filmsDetail.class),1)]),c("div",H,[B,f(r(d.formatterTimeYear(a.filmsDetail.year)),1)]),c("div",J,[z,f(r(d.formatterTime(a.filmsDetail.created)),1)]),c("div",Q,[R,f(r(a.nickname),1)]),c("div",G,[K,c(p,{"model-value":a.filmsDetail.rateValue,"allow-half":"",disabled:""},null,8,["model-value"])])])]),c("div",P,[c("a",{href:a.filmsDetail.link,target:"_blank"},[W],8,["href"]),!i.isLoved&&i.islogin?(o(),n("i",{key:0,class:"el-icon-star-off",onClick:t[1]||(t[1]=e=>d.getStar(a.filmsDetail._id))})):h("",!0),i.isLoved&&i.islogin?(o(),n("i",{key:1,class:"el-icon-star-on",onClick:t[2]||(t[2]=e=>d.delStar(a.filmsDetail._id)),style:{color:"#fcc"}})):h("",!0),i.islogin?(o(),n("i",{key:2,class:"el-icon-chat-square",onClick:t[3]||(t[3]=(...e)=>d.toChat&&d.toChat(...e))})):h("",!0),"admin"==i.userAuth?(o(),n("i",{key:3,class:"el-icon-edit",onClick:t[4]||(t[4]=e=>i.dialogTableVisible=!0)})):h("",!0)]),i.chating?(o(),n(g,{key:0,filmid:a.filmsDetail._id,onNochat:d.noChat},null,8,["filmid","onNochat"])):h("",!0),c("div",X,[Z,c(b,{type:"textarea",modelValue:a.filmsDetail.jianjie,"onUpdate:modelValue":t[5]||(t[5]=e=>a.filmsDetail.jianjie=e),autosize:"",readonly:"",resize:"none",autofocus:"false",style:{"margin-bottom":"20px"},"input-style":i.textareaStyle},null,8,["modelValue","input-style"]),ee,c("p",null,r(a.filmsDetail.liyou),1)]),c(v,{filmid:a.filmsDetail._id,ref:"comment"},null,8,["filmid"])])])),_:1},8,["loading"])])),_:1})]),c(_,{title:"信息修改",modelValue:i.dialogTableVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>i.dialogTableVisible=e),top:"5vh",fullscreen:""},{default:S((()=>[c(k,{type:"2",filmsData:a.filmsDetail,onHideDialog:d.hideDialog},null,8,["filmsData","onHideDialog"])])),_:1},8,["modelValue"])],64)}));$.render=te,$.__scopeId="data-v-c94f236e";export default $;
