import{c as N,s as p,r as u,o as m,a as b,h as g,j as L,b as t,f as a,g as n,aa as U,p as R,d as E,e as c}from"./vendor.1807abaf.js";import{_ as S}from"./main.79ca7377.js";const B={data(){return{dialogImageUrl:"",dialogVisible:!1,disabled:!1,fileList:[],radio:"\u5F71\u89C6\u5267",cloud:N.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,up:!1}},props:{type:String,shareData:Object},setup(s){return{input:p(""),input2:p(""),input3:p(""),input4:p(""),playlink:p(""),year:p("2021"),rateValue:p(null),nickname:"",user:""}},created(){this.auth=this.cloud.auth({persistence:"local"});const s=this.auth.currentUser;this.user=s,this.shareData&&(this.input=this.shareData.name,this.input2=this.shareData.link,this.input3=this.shareData.jianjie,this.input4=this.shareData.liyou,this.playlink=this.shareData.playlink,this.radio=this.shareData.class,this.rateValue=this.shareData.rateValue,this.year=this.shareData.year,this.fileList=[{name:this.shareData.name,url:this.shareData.tempFileURL,fileID:this.shareData.fileID}]),this.debouncedClick=_.debounce(this.upload,500)},unmounted(){this.debouncedClick.cancel()},methods:{handleRemove(s){this.$refs.upload.clearFiles()},handlePictureCardPreview(s){this.dialogImageUrl=s.url,this.dialogVisible=!0},handleDownload(s){console.log(s)},fileChange(s,e){this.fileList=e,console.log(e),this.up=!0},upload(){const s=this.cloud.database();s.collection("shares").where({name:this.input}).get().then(e=>{e.data.length==0?this.fileList[0]?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(h=>{let i=[];i.push(h.fileID),this.cloud.getTempFileURL({fileList:i}).then(o=>{console.log(o.fileList),s.collection("shares").add({class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,created:Date.now(),updated:Date.now(),fileID:o.fileID,owner:this.user.nickName,tempFileURL:o.fileList[0].tempFileURL}).then(d=>{this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u4E0A\u4F20\u6210\u529F\u4E86!",type:"success"}),NProgress.done();const f=this.auth.currentUser,v=s.command;s.collection("user").where({_openid:f.uid}).update({score:v.inc(1)}).then(y=>{console.log(y)}),this.input="",this.input2="",this.input3="",this.input4="",this.playlink="",this.$refs.upload.clearFiles(),this.radio="1"})})}):this.$ElMessage.error("\u9519\u4E86\u54E6\uFF0C\u672A\u9009\u62E9\u56FE\u7247!"):this.$ElMessage.error("\u6570\u636E\u5DF2\u5B58\u5728!")})},update(){const s=this.cloud.database();this.up?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(e=>{let h=[];h.push(e.fileID),this.cloud.getTempFileURL({fileList:h}).then(i=>{console.log(i.fileList),s.collection("shares").where({_id:this.shareData._id}).update({class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,created:Date.now(),updated:Date.now(),owner:this.user.nickName,fileID:i.fileList[0].fileID,tempFileURL:i.fileList[0].tempFileURL}).then(o=>{this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E86!",type:"success"});let d=[];d.push(this.shareData.fileID),console.log(d,"111"),this.cloud.deleteFile({fileList:d}).then(f=>{console.log(f.fileList)}),NProgress.done()})})}):s.collection("shares").where({_id:this.shareData._id}).update({class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,rateValue:this.rateValue,year:this.year,liyou:this.input4,owner:this.user.nickName,playlink:this.playlink,updated:Date.now()}).then(e=>{this.$emit("hideDialog"),this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E86!",type:"success"}),NProgress.done()})}},components:{}},r=s=>(R("data-v-d657e9d8"),s=s(),E(),s),K={class:"shares-upload"},M={key:0},z={class:"shares-upload-main"},T={class:"shares-upload-left"},q=r(()=>t("h3",{style:{}},"\u5C01\u9762(125*180)",-1)),O=["src"],A={class:"el-upload-list__item-actions",style:{display:"flex","align-items":"center"}},G=["onClick"],H=["onClick"],J={class:"upload-left-btn"},Q=c("\u91CD\u7F6E"),W=["src"],X={class:"shares-upload-right"},Y=r(()=>t("h3",null,"\u57FA\u672C\u4FE1\u606F",-1)),Z={class:"input-item"},$=r(()=>t("span",null,"\u8BC4\u661F",-1)),ee={class:"input-item-class"},te={class:"input-item"},le=r(()=>t("span",null,"\u5E74\u4EFD",-1)),se={class:"input-item-class"},ie={class:"input-item"},ae=r(()=>t("span",null,"\u7C7B\u522B",-1)),oe={class:"input-item-div"},ne=c("\u5F71\u89C6\u5267"),de=c("\u52A8\u6F2B"),ue=c("\u6E38\u620F"),re=c("\u5176\u4ED6"),he={class:"input-item"},pe=r(()=>t("span",null,"\u540D\u79F0",-1)),ce={class:"input-item"},_e=r(()=>t("span",null,"\u94FE\u63A5",-1)),me={class:"input-item"},fe=r(()=>t("span",null,"BV",-1)),ye={class:"input-item"},Ve=r(()=>t("span",null,"\u7B80\u4ECB",-1)),ge={class:"input-item"},ke=r(()=>t("span",null,"\u7406\u7531",-1)),ve=c("\u4E0A\u4F20"),De=c("\u66F4\u65B0");function be(s,e,h,i,o,d){const f=u("el-divider"),v=u("plus"),y=u("el-icon"),w=u("zoom-in"),C=u("delete"),I=u("el-upload"),D=u("el-button"),F=u("el-dialog"),j=u("el-rate"),x=u("el-date-picker"),k=u("el-radio"),V=u("el-input");return m(),b("div",K,[this.shareData?g("",!0):(m(),b("h2",M,"\u4E0A\u4F20\u5F71\u89C6")),this.shareData?g("",!0):(m(),L(f,{key:1,class:"timeline"})),t("div",z,[t("div",T,[q,a(I,{action:"#","list-type":"picture-card","auto-upload":!1,limit:1,"file-list":o.fileList,ref:"upload","on-change":d.fileChange,class:"shares-upload-img"},{default:n(()=>[a(y,null,{default:n(()=>[a(v)]),_:1})]),file:n(({file:l})=>[t("div",null,[t("img",{class:"el-upload-list__item-thumbnail",src:l.url,alt:""},null,8,O),t("span",A,[t("span",{class:"el-upload-list__item-preview",onClick:P=>d.handlePictureCardPreview(l)},[a(y,null,{default:n(()=>[a(w)]),_:1})],8,G),o.disabled?g("",!0):(m(),b("span",{key:0,class:"el-upload-list__item-delete",onClick:P=>d.handleRemove(l)},[a(y,null,{default:n(()=>[a(C)]),_:1})],8,H))])])]),_:1},8,["file-list","on-change"]),t("div",J,[a(D,{type:"primary",style:{"margin-top":"20px"},round:""},{default:n(()=>[Q]),_:1})]),a(F,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=l=>o.dialogVisible=l)},{default:n(()=>[t("img",{src:o.dialogImageUrl,alt:"",height:"300"},null,8,W)]),_:1},8,["modelValue"])]),t("div",X,[Y,t("div",Z,[$,t("div",ee,[a(j,{modelValue:i.rateValue,"onUpdate:modelValue":e[1]||(e[1]=l=>i.rateValue=l),"allow-half":""},null,8,["modelValue"])])]),t("div",te,[le,t("div",se,[a(x,{modelValue:i.year,"onUpdate:modelValue":e[2]||(e[2]=l=>i.year=l),type:"year",placeholder:"\u9009\u62E9\u5E74"},null,8,["modelValue"])])]),t("div",ie,[ae,t("div",oe,[a(k,{modelValue:o.radio,"onUpdate:modelValue":e[3]||(e[3]=l=>o.radio=l),label:"\u5F71\u89C6\u5267"},{default:n(()=>[ne]),_:1},8,["modelValue"]),a(k,{modelValue:o.radio,"onUpdate:modelValue":e[4]||(e[4]=l=>o.radio=l),label:"\u52A8\u6F2B"},{default:n(()=>[de]),_:1},8,["modelValue"]),a(k,{modelValue:o.radio,"onUpdate:modelValue":e[5]||(e[5]=l=>o.radio=l),label:"\u6E38\u620F"},{default:n(()=>[ue]),_:1},8,["modelValue"]),a(k,{modelValue:o.radio,"onUpdate:modelValue":e[6]||(e[6]=l=>o.radio=l),label:"\u5176\u4ED6"},{default:n(()=>[re]),_:1},8,["modelValue"])])]),t("div",he,[pe,a(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:i.input,"onUpdate:modelValue":e[7]||(e[7]=l=>i.input=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",ce,[_e,a(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:i.input2,"onUpdate:modelValue":e[8]||(e[8]=l=>i.input2=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",me,[fe,a(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:i.playlink,"onUpdate:modelValue":e[9]||(e[9]=l=>i.playlink=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",ye,[Ve,a(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"textarea",autosize:"",modelValue:i.input3,"onUpdate:modelValue":e[10]||(e[10]=l=>i.input3=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",ge,[ke,a(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:i.input4,"onUpdate:modelValue":e[11]||(e[11]=l=>i.input4=l),type:"textarea",autosize:"",clearable:"",class:"film-input"},null,8,["modelValue"])]),h.type!=2?(m(),L(D,{key:0,type:"primary",style:{"margin-top":"20px"},onClick:d.upload,onKeyup:U(d.upload,["enter"]),round:""},{default:n(()=>[ve]),_:1},8,["onClick","onKeyup"])):g("",!0),h.type==2?(m(),L(D,{key:1,type:"primary",style:{"margin-top":"20px"},onClick:d.update,onKeyup:U(d.update,["enter"]),round:""},{default:n(()=>[De]),_:1},8,["onClick","onKeyup"])):g("",!0)])])])}var we=S(B,[["render",be],["__scopeId","data-v-d657e9d8"]]);export{we as default};
