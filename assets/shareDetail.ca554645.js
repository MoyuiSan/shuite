import B from"./ShareUpload.6c6d9593.js";import{r as a,o as d,a as u,F as w,a7 as O,b as l,t as h,h as r,j as v,p as C,d as F,f as o,g as m,e as y,s as V}from"./vendor.1807abaf.js";import{_ as k}from"./main.2e4e7b6f.js";const z={data(){return{email:"1193292553@qq.com",filmDetail:[],auth:localStorage.getItem("user_auth")=="admin"}},props:["filmid"],created(){this.getComments()},methods:{getComments(){const t=this.$cloudbase.database();t.command,t.collection("chats").where({filmId:this.filmid,chatFrom:"film",isOk:1}).get().then(e=>{this.filmDetail=e.data})},formaTime(t){return moment(t).fromNow()},deleteComment(t){this.$cloudbase.callFunction({name:"shuiteApi",data:{id:t,event:"DELETE_FILM_COMMENT",secret:"gyc199700"}}).then(e=>{this.$ElMessage.success({message:"\u5220\u9664\u6210\u529F\u4E86!",type:"success"}),this.getComments()}).catch(console.error)}},components:[]},S=t=>(C("data-v-7919c777"),t=t(),F(),t),G={class:"film-chats boxshadow"},J=S(()=>l("h3",null,"\u8BC4\u8BBA",-1)),P={class:"chat-box"},R=["src"],K={class:"chat-box-message"},Q=S(()=>l("span",null,"\u6765\u81EA\u5FEB\u4E50\u661F\u7403",-1)),W=["onClick"],X={class:"message"};function Z(t,e,n,s,i,c){const g=a("el-empty");return d(),u("div",G,[J,(d(!0),u(w,null,O(i.filmDetail,f=>(d(),u("div",P,[l("img",{src:"https://q1.qlogo.cn/g?b=qq&nk="+f.email+"&s=640"},null,8,R),l("div",K,[l("p",null,h(f.nickname),1),l("p",null,[l("div",null,[Q,l("span",null,h(c.formaTime(f.created)),1)]),i.auth?(d(),u("span",{key:0,onClick:D=>c.deleteComment(f._id),class:"chat-delete"},"\u5220\u9664",8,W)):r("",!0)]),l("div",X,h(f.chat),1)])]))),256)),i.filmDetail[0]?r("",!0):(d(),v(g,{key:0,description:"\u6682\u65E0\u7559\u8A00..."}))])}var $=k(z,[["render",Z],["__scopeId","data-v-7919c777"]]);const ee={data(){return{input:""}},props:["filmid","filmname"],methods:{submitChat(){const t=this.$auth.currentUser,e=this.$cloudbase.database();e.command,e.collection("chats").add({filmId:this.filmid,filmName:this.filmname,chatFrom:"film",chat:this.input,nickname:t.nickName,appVersion:navigator.appVersion,email:t.email,created:Date.now(),updated:Date.now(),isOk:1}).then(n=>{this.$emit("nochat"),this.$ElMessage.success({message:"\u5410\u69FD\u6210\u529F\u4E86!",type:"success"})})}},components:{}},te={class:"film-gochat boxshadow"},le=y("\u63D0\u4EA4");function ie(t,e,n,s,i,c){const g=a("el-input"),f=a("el-button");return d(),u("div",te,[o(g,{placeholder:"\u5410\u69FD\u4E00\u4E0B\u5427",modelValue:i.input,"onUpdate:modelValue":e[0]||(e[0]=D=>i.input=D),clearable:"",class:"shuite-search"},null,8,["modelValue"]),o(f,{onClick:c.submitChat,type:"small",style:{height:"40px","margin-left":"10px"}},{default:m(()=>[le]),_:1},8,["onClick"])])}var se=k(ee,[["render",ie],["__scopeId","data-v-efd317b8"]]);const oe={data(){return{loading:!0,post:null,error:null,cloud:cloudbase.init({env:"yui-7gel1hqtaf6fb79d"}),dialogTableVisible:!1,userAuth:localStorage.getItem("user_auth"),isLoved:!1,textareaStyle:{border:0,padding:0,color:"black"},chating:!1,islogin:!1,preFilm:"",nextFilm:""}},setup(t){return{filmDetail:V(""),nickname:V("")}},created(){this.cloud.auth({persistence:"local"}),this.getFilmDetail(),JSON.parse(localStorage.getItem("login_type_yui-7gel1hqtaf6fb79d")).content=="EMAIL"&&(this.islogin=!0)},methods:{formatterTime(t,e,n,s){return moment(n).format("YYYY/MM/DD")},formatterTimeYear(t,e,n,s){return moment(t).format("YYYY")},getFilmDetail(t){this.$auth.getAuthHeader();const e=this.cloud.database();e.command,scrollTo(0,0),e.collection("shares").where({_id:t||this.$route.params.id}).orderBy("created","desc").limit(1).get().then(n=>{this.filmDetail=n.data[0],this.$refs.comment&&this.$refs.comment.getComments(),e.collection("user").where({_openid:this.filmDetail._openid}).get().then(s=>{this.nickname=s.data[0].nickname,this.getPreFilm(),this.getNextFilm(),e.collection("mylove").where({_openid:this.filmDetail._openid,filmId:this.filmDetail._id}).get().then(i=>{i.data[0]?this.isLoved=!0:this.isLoved=!1;let c=setTimeout(()=>{this.loading=!1,clearTimeout(c)},200);c=null})})})},getStar(t){const e=this.$auth.getAuthHeader(),n=this.$cloudbase.database();n.command,JSON.parse(localStorage.getItem("login_type_yui-7gel1hqtaf6fb79d")).content=="ANONYMOUS"?ElMessage.info("\u8BF7\u5148\u767B\u5F55\u54E6!!!"):n.collection("mylove").where({_openid:e.uid,filmId:t}).get().then(i=>{i.data[0]||n.collection("mylove").add({filmId:t,created:Date.now(),updated:Date.now()}).then(c=>{this.getFilmDetail(),this.$ElMessage.success({message:"\u6536\u85CF\u6210\u529F\u4E86!",type:"success"})})})},delStar(t){const e=this.$auth.getAuthHeader(),n=this.$cloudbase.database();n.command,n.collection("mylove").where({_openid:e.uid,filmId:t}).remove().then(s=>{this.getFilmDetail(),this.$ElMessage.success({message:"\u53D6\u6D88\u6536\u85CF\u4E86!",type:"success"})})},getPreFilm(){console.log(this.filmDetail);const t=this.$cloudbase.database(),e=t.command;t.collection("shares").where({created:e.gt(this.filmDetail.created)}).orderBy("created","asc").limit(1).get().then(n=>{this.preFilm=n.data})},getNextFilm(){console.log(this.filmDetail);const t=this.$cloudbase.database(),e=t.command;t.collection("shares").where({created:e.lt(this.filmDetail.created)}).orderBy("created","desc").limit(1).get().then(n=>{this.nextFilm=n.data})},toChat(){this.chating=!0},noChat(){this.chating=!1,this.$refs.comment.getComments()},hideDialog(){this.dialogTableVisible=!1,this.getFilmDetail()}},components:{"share-upload":B,"share-chats":$,"share-gochat":se}},p=t=>(C("data-v-2bdd1383"),t=t(),F(),t),ae={class:"filmdetail"},ne={style:{padding:"14px"}},ce={style:{display:"flex","align-items":"center","justify-items":"space-between","margin-top":"16px",height:"16px"}},de={class:"share-box"},re={class:"share-top"},me=["src"],he={class:"share-message"},_e={class:"name"},ue=p(()=>l("span",null,"\u540D\u79F0:",-1)),fe={class:"fclass"},pe=p(()=>l("span",null,"\u7C7B\u578B:",-1)),ge={class:"jianjie"},ve=p(()=>l("span",null,"\u5E74\u4EFD:",-1)),ye={class:"upload-time"},be=p(()=>l("span",null,"\u4E0A\u4F20\u65F6\u95F4:",-1)),De={class:"upload-owner"},ke=p(()=>l("span",null,"\u4E0A\u4F20\u8005:",-1)),xe={class:"rate",style:{display:"flex"}},we=p(()=>l("span",null,"\u8BC4\u5206:",-1)),Ce={class:"share-btn boxshadow"},Fe=["href"],Ve={key:1,class:"share-vedio boxshadow"},Se=p(()=>l("h3",null,"\u89C6\u9891",-1)),Te=["src"],Ie={class:"share-main boxshadow"},Ne=p(()=>l("h3",null,"\u7B80\u4ECB",-1)),Me=p(()=>l("h3",null,"\u63A8\u8350\u7406\u7531",-1)),je={class:"recommend boxshadow"},Ee={class:"recommend-left"},Ye=y(" \u4E0A\u4E00\u4E2A "),Le={key:1},qe={class:"recommend-right"},Ue=y(" \u4E0B\u4E00\u4E2A "),Ae={key:1};function He(t,e,n,s,i,c){const g=a("el-skeleton-item"),f=a("el-rate"),D=a("paperclip"),b=a("el-icon"),T=a("star"),I=a("star-filled"),N=a("chat-round"),M=a("edit"),j=a("aim"),E=a("share-gochat"),Y=a("el-input"),L=a("share-chats"),x=a("router-link"),q=a("el-skeleton"),U=a("el-space"),A=a("films-upload"),H=a("el-dialog");return d(),u(w,null,[l("div",ae,[o(U,{direction:"vertical",alignment:"flex-start",class:"shuite-el-space"},{default:m(()=>[o(q,{rows:15,animated:"",loading:i.loading,class:"shuite-el-skeleton"},{template:m(()=>[o(g,{variant:"image",style:{height:"267px"},class:"shuite-el-skeleton-item"}),l("div",ne,[o(g,{variant:"h3",style:{width:"50%"}}),l("div",ce,[o(g,{variant:"text",style:{"margin-right":"16px"}}),o(g,{variant:"text",style:{width:"30%"}})])])]),default:m(()=>[l("div",de,[l("div",re,[s.filmDetail?(d(),u("img",{key:0,src:s.filmDetail.tempFileURL},null,8,me)):r("",!0),l("div",he,[l("div",_e,[ue,y(h(s.filmDetail.name),1)]),l("div",fe,[pe,y(h(s.filmDetail.class),1)]),l("div",ge,[ve,y(h(c.formatterTimeYear(s.filmDetail.year)),1)]),l("div",ye,[be,y(h(c.formatterTime(s.filmDetail.created)),1)]),l("div",De,[ke,y(h(s.nickname),1)]),l("div",xe,[we,o(f,{modelValue:s.filmDetail.rateValue,"onUpdate:modelValue":e[0]||(e[0]=_=>s.filmDetail.rateValue=_),"allow-half":"","show-score":"",disabled:""},null,8,["modelValue"])])])]),l("div",Ce,[l("a",{href:s.filmDetail.link,target:"_blank"},[o(b,null,{default:m(()=>[o(D)]),_:1})],8,Fe),!i.isLoved&&i.islogin?(d(),v(b,{key:0,onClick:e[1]||(e[1]=_=>c.getStar(s.filmDetail._id))},{default:m(()=>[o(T)]),_:1})):r("",!0),i.isLoved&&i.islogin?(d(),v(b,{key:1,onClick:e[2]||(e[2]=_=>c.delStar(s.filmDetail._id))},{default:m(()=>[o(I,{style:{color:"#fcc"}})]),_:1})):r("",!0),i.islogin?(d(),v(b,{key:2,onClick:c.toChat},{default:m(()=>[o(N)]),_:1},8,["onClick"])):r("",!0),i.userAuth=="admin"?(d(),v(b,{key:3,onClick:e[3]||(e[3]=_=>i.dialogTableVisible=!0)},{default:m(()=>[o(M)]),_:1})):r("",!0),o(b,null,{default:m(()=>[o(j)]),_:1})]),i.chating?(d(),v(E,{key:0,filmid:s.filmDetail._id,filmname:s.filmDetail.name,onNochat:c.noChat,class:"boxshadow"},null,8,["filmid","filmname","onNochat"])):r("",!0),s.filmDetail.playlink?(d(),u("div",Ve,[Se,l("iframe",{src:"//player.bilibili.com/player.html?bvid="+s.filmDetail.playlink+"&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:"iframe-vedio"},`\r
              `,8,Te)])):r("",!0),l("div",Ie,[Ne,o(Y,{type:"textarea",modelValue:s.filmDetail.jianjie,"onUpdate:modelValue":e[4]||(e[4]=_=>s.filmDetail.jianjie=_),autosize:"",readonly:"",resize:"none",autofocus:"false",style:{"margin-bottom":"20px"},"input-style":i.textareaStyle},null,8,["modelValue","input-style"]),Me,l("p",null,h(s.filmDetail.liyou),1)]),o(L,{filmid:s.filmDetail._id,ref:"comment"},null,8,["filmid"]),l("div",je,[l("div",Ee,[i.preFilm[0]?(d(),v(x,{key:0,to:"/filmdetail/"+i.preFilm[0]._id,onClick:e[5]||(e[5]=_=>c.getFilmDetail(i.preFilm[0]._id))},{default:m(()=>[Ye]),_:1},8,["to"])):r("",!0),i.preFilm[0]?(d(),u("p",Le,h(i.preFilm[0].name),1)):r("",!0)]),l("div",qe,[i.nextFilm[0]?(d(),v(x,{key:0,to:"/filmdetail/"+i.nextFilm[0]._id,onClick:e[6]||(e[6]=_=>c.getFilmDetail(i.nextFilm[0]._id))},{default:m(()=>[Ue]),_:1},8,["to"])):r("",!0),i.nextFilm[0]?(d(),u("p",Ae,h(i.nextFilm[0].name),1)):r("",!0)])])])]),_:1},8,["loading"])]),_:1})]),o(H,{title:"\u4FE1\u606F\u4FEE\u6539",modelValue:i.dialogTableVisible,"onUpdate:modelValue":e[7]||(e[7]=_=>i.dialogTableVisible=_),top:"5vh",fullscreen:""},{default:m(()=>[o(A,{type:"2",filmsData:s.filmDetail,onHideDialog:c.hideDialog},null,8,["filmsData","onHideDialog"])]),_:1},8,["modelValue"])],64)}var Ge=k(oe,[["render",He],["__scopeId","data-v-2bdd1383"]]);export{Ge as default};
