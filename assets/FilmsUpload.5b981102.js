import{c as C,s as c,r,o as f,a as D,f as d,g as u,b as l,h as V,j as L,a7 as w,p as F,d as I,e as h}from"./vendor.aac64fcf.js";import{_ as P}from"./main.a31aa49f.js";const j={data(){return{dialogImageUrl:"",dialogVisible:!1,disabled:!1,fileList:[],radio:"\u5F71\u89C6\u5267",cloud:C.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,up:!1}},props:{type:String,filmsData:Object},setup(i){return{input:c(""),input2:c(""),input3:c(""),input4:c(""),playlink:c(""),year:c("2021"),rateValue:c(null),nickname:"",user:""}},created(){this.auth=this.cloud.auth({persistence:"local"});const i=this.auth.currentUser;this.user=i,this.filmsData&&(this.input=this.filmsData.name,this.input2=this.filmsData.link,this.input3=this.filmsData.jianjie,this.input4=this.filmsData.liyou,this.playlink=this.filmsData.playlink,this.radio=this.filmsData.class,this.rateValue=this.filmsData.rateValue,this.year=this.filmsData.year,this.fileList=[{name:this.filmsData.name,url:this.filmsData.tempFileURL,fileID:this.filmsData.fileID}])},methods:{handleRemove(i){this.$refs.upload.clearFiles()},handlePictureCardPreview(i){this.dialogImageUrl=i.url,this.dialogVisible=!0},handleDownload(i){console.log(i)},fileChange(i,e){this.fileList=e,console.log(e),this.up=!0},upload(){const i=this.cloud.database();i.collection("films").where({name:this.input}).get().then(e=>{e.data.length==0?this.fileList[0]?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(p=>{let s=[];s.push(p.fileID),this.cloud.getTempFileURL({fileList:s}).then(a=>{console.log(a.fileList),i.collection("films").add({class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,created:Date.now(),updated:Date.now(),fileID:a.fileID,owner:this.user.nickName,tempFileURL:a.fileList[0].tempFileURL}).then(n=>{ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u4E0A\u4F20\u6210\u529F\u4E86!",type:"success"}),NProgress.done();const m=this.auth.currentUser,g=i.command;i.collection("user").where({_openid:m.uid}).update({score:g.inc(1)}).then(k=>{console.log(k)}),this.input="",this.input2="",this.input3="",this.input4="",this.playlink="",this.$refs.upload.clearFiles(),this.radio="1"})})}):(ElMessage.error("\u9519\u4E86\u54E6\uFF0C\u672A\u9009\u62E9\u56FE\u7247!"),NProgress.done()):ElMessage.error("\u6570\u636E\u5DF2\u5B58\u5728!")})},test(){console.log(this.filmsData)},update(){NProgress.start();const i=this.cloud.database();this.up?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(e=>{let p=[];p.push(e.fileID),this.cloud.getTempFileURL({fileList:p}).then(s=>{console.log(s.fileList),i.collection("films").where({_id:this.filmsData._id}).update({class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,created:Date.now(),updated:Date.now(),owner:this.user.nickName,fileID:s.fileList[0].fileID,tempFileURL:s.fileList[0].tempFileURL}).then(a=>{ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E86!",type:"success"});let n=[];n.push(this.filmsData.fileID),console.log(n,"111"),this.cloud.deleteFile({fileList:n}).then(m=>{console.log(m.fileList)}),NProgress.done()})})}):i.collection("films").where({_id:this.filmsData._id}).update({class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,rateValue:this.rateValue,year:this.year,liyou:this.input4,owner:this.user.nickName,playlink:this.playlink,updated:Date.now()}).then(e=>{this.$emit("hideDialog"),ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E86!",type:"success"}),NProgress.done()})}},components:{}},o=i=>(F("data-v-36958939"),i=i(),I(),i),N={class:"films-upload"},x=o(()=>l("h3",null,"\u5C55\u793A\u56FE(125*180)",-1)),R=o(()=>l("i",{class:"el-icon-plus"},null,-1)),E=["src"],B={class:"el-upload-list__item-actions",style:{display:"flex","align-items":"center"}},K=["onClick"],M=o(()=>l("i",{class:"el-icon-zoom-in"},null,-1)),S=[M],z=["onClick"],T=o(()=>l("i",{class:"el-icon-download"},null,-1)),q=[T],O=["onClick"],A=o(()=>l("i",{class:"el-icon-delete"},null,-1)),G=[A],H=["src"],J=o(()=>l("h3",null,"\u57FA\u672C\u4FE1\u606F",-1)),Q={class:"input-item"},W=o(()=>l("span",null,"\u8BC4\u661F",-1)),X={class:"input-item-class"},Y={class:"input-item"},Z=o(()=>l("span",null,"\u5E74\u4EFD",-1)),$={class:"input-item-class"},ee={class:"input-item"},le=o(()=>l("span",null,"\u7C7B\u522B",-1)),te={class:"input-item-div"},ie=h("\u5F71\u89C6\u5267"),se=h("\u52A8\u6F2B"),ae=h("\u6E38\u620F"),oe=h("\u5176\u4ED6"),ne={class:"input-item"},de=o(()=>l("span",null,"\u540D\u79F0",-1)),ue={class:"input-item"},pe=o(()=>l("span",null,"\u94FE\u63A5",-1)),ce={class:"input-item"},re=o(()=>l("span",null,"BV",-1)),he={class:"input-item"},me=o(()=>l("span",null,"\u7B80\u4ECB",-1)),_e={class:"input-item"},fe=o(()=>l("span",null,"\u7406\u7531",-1)),ye=h("\u4E0A\u4F20"),Ve=h("\u66F4\u65B0");function ge(i,e,p,s,a,n){const m=r("el-upload"),g=r("el-dialog"),k=r("el-rate"),U=r("el-date-picker"),y=r("el-radio"),_=r("el-input"),v=r("el-button");return f(),D("div",N,[x,d(m,{action:"#","list-type":"picture-card","auto-upload":!1,limit:1,"file-list":a.fileList,ref:"upload","on-change":n.fileChange,class:"films-upload-img"},{default:u(()=>[R]),file:u(({file:t})=>[l("div",null,[l("img",{class:"el-upload-list__item-thumbnail",src:t.url,alt:""},null,8,E),l("span",B,[l("span",{class:"el-upload-list__item-preview",onClick:b=>n.handlePictureCardPreview(t)},S,8,K),a.disabled?V("",!0):(f(),D("span",{key:0,class:"el-upload-list__item-delete",onClick:b=>n.handleDownload(t)},q,8,z)),a.disabled?V("",!0):(f(),D("span",{key:1,class:"el-upload-list__item-delete",onClick:b=>n.handleRemove(t)},G,8,O))])])]),_:1},8,["file-list","on-change"]),d(g,{modelValue:a.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=t=>a.dialogVisible=t)},{default:u(()=>[l("img",{src:a.dialogImageUrl,alt:"",height:"300"},null,8,H)]),_:1},8,["modelValue"]),J,l("div",Q,[W,l("div",X,[d(k,{modelValue:s.rateValue,"onUpdate:modelValue":e[1]||(e[1]=t=>s.rateValue=t),"allow-half":""},null,8,["modelValue"])])]),l("div",Y,[Z,l("div",$,[d(U,{modelValue:s.year,"onUpdate:modelValue":e[2]||(e[2]=t=>s.year=t),type:"year",placeholder:"\u9009\u62E9\u5E74"},null,8,["modelValue"])])]),l("div",ee,[le,l("div",te,[d(y,{modelValue:a.radio,"onUpdate:modelValue":e[3]||(e[3]=t=>a.radio=t),label:"\u5F71\u89C6\u5267"},{default:u(()=>[ie]),_:1},8,["modelValue"]),d(y,{modelValue:a.radio,"onUpdate:modelValue":e[4]||(e[4]=t=>a.radio=t),label:"\u52A8\u6F2B"},{default:u(()=>[se]),_:1},8,["modelValue"]),d(y,{modelValue:a.radio,"onUpdate:modelValue":e[5]||(e[5]=t=>a.radio=t),label:"\u6E38\u620F"},{default:u(()=>[ae]),_:1},8,["modelValue"]),d(y,{modelValue:a.radio,"onUpdate:modelValue":e[6]||(e[6]=t=>a.radio=t),label:"\u5176\u4ED6"},{default:u(()=>[oe]),_:1},8,["modelValue"])])]),l("div",ne,[de,d(_,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:s.input,"onUpdate:modelValue":e[7]||(e[7]=t=>s.input=t),clearable:"",class:"film-input"},null,8,["modelValue"])]),l("div",ue,[pe,d(_,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:s.input2,"onUpdate:modelValue":e[8]||(e[8]=t=>s.input2=t),clearable:"",class:"film-input"},null,8,["modelValue"])]),l("div",ce,[re,d(_,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:s.playlink,"onUpdate:modelValue":e[9]||(e[9]=t=>s.playlink=t),clearable:"",class:"film-input"},null,8,["modelValue"])]),l("div",he,[me,d(_,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"textarea",autosize:"",modelValue:s.input3,"onUpdate:modelValue":e[10]||(e[10]=t=>s.input3=t),clearable:"",class:"film-input"},null,8,["modelValue"])]),l("div",_e,[fe,d(_,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:s.input4,"onUpdate:modelValue":e[11]||(e[11]=t=>s.input4=t),type:"textarea",autosize:"",clearable:"",class:"film-input"},null,8,["modelValue"])]),p.type!=2?(f(),L(v,{key:0,type:"primary",style:{"margin-top":"20px"},onClick:n.upload,onKeyup:w(n.upload,["enter"])},{default:u(()=>[ye]),_:1},8,["onClick","onKeyup"])):V("",!0),p.type==2?(f(),L(v,{key:1,type:"primary",style:{"margin-top":"20px"},onClick:n.update,onKeyup:w(n.update,["enter"])},{default:u(()=>[Ve]),_:1},8,["onClick","onKeyup"])):V("",!0)])}var ve=P(j,[["render",ge],["__scopeId","data-v-36958939"]]);export{ve as default};
