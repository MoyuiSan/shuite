import{aa as M,h as P,m as n,r as i,o as d,c as D,d as C,e as y,a as t,b as a,w as u,F as N,a5 as j,ab as v,p as R,g as S,f as p}from"./vendor.7bf13f67.js";import{_ as K}from"./main.4b1474ee.js";const z=M({data(){return{dialogImageUrl:"",dialogVisible:!1,disabled:!1,fileList:[],radio:"\u5F71\u89C6\u5267",cloud:P.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,up:!1,smallClassList:[{bigClass:"\u5F71\u89C6\u5267",smallClass:"\u65E5\u5267"},{bigClass:"\u5F71\u89C6\u5267",smallClass:"\u56FD\u4EA7\u5267"},{bigClass:"\u5F71\u89C6\u5267",smallClass:"\u6B27\u7F8E\u5267"},{bigClass:"\u5F71\u89C6\u5267",smallClass:"\u7F51\u98DE"},{bigClass:"\u52A8\u6F2B",smallClass:"\u65E5\u6F2B"},{bigClass:"\u52A8\u6F2B",smallClass:"\u56FD\u6F2B"},{bigClass:"\u52A8\u6F2B",smallClass:"\u5176\u4ED6"},{bigClass:"\u6E38\u620F",smallClass:"\u56FD\u4EA7\u6E38\u620F"},{bigClass:"\u6E38\u620F",smallClass:"\u65E5\u672C\u6E38\u620F"},{bigClass:"\u6E38\u620F",smallClass:"\u72EC\u7ACB\u6E38\u620F"},{bigClass:"\u5176\u4ED6",smallClass:"\u5176\u4ED6"}]}},props:{type:String,shareData:Object},setup(e){return{input:n(""),input2:n(""),input3:n(""),input4:n(""),playlink:n(""),year:n("2021"),rateValue:n(null),nickname:"",user:"",smallClassNow:n("")}},computed:{smallClassGet(){return this.smallClassList.filter(s=>!s.bigClass.indexOf(this.radio))}},created(){this.auth=this.cloud.auth({persistence:"local"});const e=this.auth.currentUser;this.user=e,this.shareData&&(this.input=this.shareData.name,this.input2=this.shareData.link,this.input3=this.shareData.jianjie,this.input4=this.shareData.liyou,this.playlink=this.shareData.playlink,this.radio=this.shareData.class,this.rateValue=this.shareData.rateValue,this.year=this.shareData.year,this.fileList=[{name:this.shareData.name,url:this.shareData.tempFileURL,fileID:this.shareData.fileID}]),this.debouncedClick=_.debounce(this.upload,500)},unmounted(){this.debouncedClick.cancel()},methods:{handleRemove(e){this.$refs.upload.clearFiles()},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleDownload(e){console.log(e)},resetInput(){this.input="",this.input2="",this.input3="",this.input4="",this.playlink="",this.$refs.upload.clearFiles(),this.radio="1",this.rateValue="",this.year="2022",this.fileList=[]},fileChange(e,s){this.fileList=s,console.log(s),this.up=!0},getParams(e){return e?{class:this.radio,smallclass:this.smallClassNow,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,timeObject:{created:Date.now(),createdFormat:moment(Date.now()).format("YYYY-MM-DD hh:mm:ss"),updated:Date.now(),updatedFormat:moment(Date.now()).format("YYYY-MM-DD hh:mm:ss")},owner:this.user.nickName,fileID:e.fileList[0].fileID,tempFileURL:e.fileList[0].tempFileURL}:{class:this.radio,smallclass:this.smallClassNow,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,timeObject:{created:Date.now(),createdFormat:moment(Date.now()).format("YYYY-MM-DD hh:mm:ss"),updated:Date.now(),updatedFormat:moment(Date.now()).format("YYYY-MM-DD hh:mm:ss")},owner:this.user.nickName}},upload(){const e=this.cloud.database(),s=this.auth.currentUser,h=e.command;e.collection("shares").where({name:this.input}).get().then(m=>{m.data.length==0?this.fileList[0]?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(V=>{let r=[];r.push(V.fileID),this.cloud.getTempFileURL({fileList:r}).then(c=>{e.collection("shares").add(this.getParams(c)).then(E=>{this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u4E0A\u4F20\u6210\u529F\u4E86!",type:"success"}),e.collection("user").where({_openid:s.uid}).update({score:h.inc(1)}).then(F=>{console.log(F)}),this.resetInput()})})}):this.$ElMessage.error("\u9519\u4E86\u54E6\uFF0C\u672A\u9009\u62E9\u56FE\u7247!"):this.$ElMessage.error("\u6570\u636E\u5DF2\u5B58\u5728!")})},update(){const e=this.cloud.database();this.up?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(s=>{let h=[];h.push(s.fileID),this.cloud.getTempFileURL({fileList:h}).then(m=>{console.log(m.fileList),e.collection("shares").where({_id:this.shareData._id}).update(this.getParams(m)).then(V=>{this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E86!",type:"success"});let r=[];r.push(this.shareData.fileID),console.log(r,"111"),this.cloud.deleteFile({fileList:r}).then(c=>{console.log(c.fileList)}),NProgress.done()})})}):e.collection("shares").where({_id:this.shareData._id}).update(this.getParams()).then(s=>{this.$emit("hideDialog"),this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E861!",type:"success"})})}},components:{}}),o=e=>(R("data-v-032a6fe2"),e=e(),S(),e),O={class:"shares-upload"},T={key:0},G={class:"shares-upload-main"},q={class:"shares-upload-left"},H=o(()=>t("h3",{style:{}},"\u5C01\u9762(125*180)",-1)),J=["src"],Q={class:"el-upload-list__item-actions",style:{display:"flex","align-items":"center"}},W=["onClick"],X=["onClick"],Z={class:"upload-left-btn"},x=p("\u91CD\u7F6E"),ee=["src"],se={class:"shares-upload-right"},le=o(()=>t("h3",null,"\u57FA\u672C\u4FE1\u606F",-1)),te={class:"input-item"},ae=o(()=>t("span",null,"\u8BC4\u661F",-1)),ie={class:"input-item-class"},ue={class:"input-item"},oe=o(()=>t("span",null,"\u5E74\u4EFD",-1)),ne={class:"input-item-class"},de={class:"input-item"},re=o(()=>t("span",null,"\u5927\u7C7B",-1)),pe={class:"input-item-div"},he=p("\u5F71\u89C6\u5267"),me=p("\u52A8\u6F2B"),ce=p("\u6E38\u620F"),_e=p("\u5176\u4ED6"),Fe={class:"input-item"},fe=o(()=>t("span",null,"\u5C0F\u7C7B",-1)),Ce={class:"input-item-div"},ge={class:"input-item"},De=o(()=>t("span",null,"\u540D\u79F0",-1)),ye={class:"input-item"},Ve=o(()=>t("span",null,"\u94FE\u63A5",-1)),be={class:"input-item"},Ee=o(()=>t("span",null,"BV",-1)),ve={class:"input-item"},ke=o(()=>t("span",null,"\u7B80\u4ECB",-1)),Be={class:"input-item"},we=o(()=>t("span",null,"\u7406\u7531",-1)),Le=p("\u4E0A\u4F20"),Ue=p("\u66F4\u65B0");function Ie(e,s,h,m,V,r){const c=i("el-divider"),E=i("plus"),F=i("el-icon"),k=i("zoom-in"),B=i("delete"),w=i("el-upload"),b=i("el-button"),L=i("el-dialog"),U=i("el-rate"),I=i("el-date-picker"),g=i("el-radio"),A=i("el-option"),Y=i("el-select"),f=i("el-input");return d(),D("div",O,[this.shareData?C("",!0):(d(),D("h2",T,"\u4E0A\u4F20\u5F71\u89C6")),this.shareData?C("",!0):(d(),y(c,{key:1,class:"timeline"})),t("div",G,[t("div",q,[H,a(w,{action:"#","list-type":"picture-card","auto-upload":!1,limit:1,"file-list":e.fileList,ref:"upload","on-change":e.fileChange,class:"shares-upload-img"},{default:u(()=>[a(F,null,{default:u(()=>[a(E)]),_:1})]),file:u(({file:l})=>[t("div",null,[t("img",{class:"el-upload-list__item-thumbnail",src:l.url,alt:""},null,8,J),t("span",Q,[t("span",{class:"el-upload-list__item-preview",onClick:$=>e.handlePictureCardPreview(l)},[a(F,null,{default:u(()=>[a(k)]),_:1})],8,W),e.disabled?C("",!0):(d(),D("span",{key:0,class:"el-upload-list__item-delete",onClick:$=>e.handleRemove(l)},[a(F,null,{default:u(()=>[a(B)]),_:1})],8,X))])])]),_:1},8,["file-list","on-change"]),t("div",Z,[a(b,{type:"primary",style:{"margin-top":"20px"},round:"",onClick:e.resetInput},{default:u(()=>[x]),_:1},8,["onClick"])]),a(L,{modelValue:e.dialogVisible,"onUpdate:modelValue":s[0]||(s[0]=l=>e.dialogVisible=l)},{default:u(()=>[t("img",{src:e.dialogImageUrl,alt:"",height:"300"},null,8,ee)]),_:1},8,["modelValue"])]),t("div",se,[le,t("div",te,[ae,t("div",ie,[a(U,{modelValue:e.rateValue,"onUpdate:modelValue":s[1]||(s[1]=l=>e.rateValue=l),"allow-half":""},null,8,["modelValue"])])]),t("div",ue,[oe,t("div",ne,[a(I,{modelValue:e.year,"onUpdate:modelValue":s[2]||(s[2]=l=>e.year=l),type:"year",placeholder:"\u9009\u62E9\u5E74"},null,8,["modelValue"])])]),t("div",de,[re,t("div",pe,[a(g,{modelValue:e.radio,"onUpdate:modelValue":s[3]||(s[3]=l=>e.radio=l),label:"\u5F71\u89C6\u5267"},{default:u(()=>[he]),_:1},8,["modelValue"]),a(g,{modelValue:e.radio,"onUpdate:modelValue":s[4]||(s[4]=l=>e.radio=l),label:"\u52A8\u6F2B"},{default:u(()=>[me]),_:1},8,["modelValue"]),a(g,{modelValue:e.radio,"onUpdate:modelValue":s[5]||(s[5]=l=>e.radio=l),label:"\u6E38\u620F"},{default:u(()=>[ce]),_:1},8,["modelValue"]),a(g,{modelValue:e.radio,"onUpdate:modelValue":s[6]||(s[6]=l=>e.radio=l),label:"\u5176\u4ED6"},{default:u(()=>[_e]),_:1},8,["modelValue"])])]),t("div",Fe,[fe,t("div",Ce,[a(Y,{modelValue:e.smallClassNow,"onUpdate:modelValue":s[7]||(s[7]=l=>e.smallClassNow=l),class:"m-2",placeholder:"Select"},{default:u(()=>[(d(!0),D(N,null,j(e.smallClassGet,l=>(d(),y(A,{key:l.smallClass,label:l.smallClass,value:l.smallClass},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",ge,[De,a(f,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.input,"onUpdate:modelValue":s[8]||(s[8]=l=>e.input=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",ye,[Ve,a(f,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.input2,"onUpdate:modelValue":s[9]||(s[9]=l=>e.input2=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",be,[Ee,a(f,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.playlink,"onUpdate:modelValue":s[10]||(s[10]=l=>e.playlink=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",ve,[ke,a(f,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"textarea",autosize:"",modelValue:e.input3,"onUpdate:modelValue":s[11]||(s[11]=l=>e.input3=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),t("div",Be,[we,a(f,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.input4,"onUpdate:modelValue":s[12]||(s[12]=l=>e.input4=l),type:"textarea",autosize:"",clearable:"",class:"film-input"},null,8,["modelValue"])]),e.type!=2?(d(),y(b,{key:0,type:"primary",style:{"margin-top":"20px"},onClick:e.upload,onKeyup:v(e.upload,["enter"]),round:""},{default:u(()=>[Le]),_:1},8,["onClick","onKeyup"])):C("",!0),e.type==2?(d(),y(b,{key:1,type:"primary",style:{"margin-top":"20px"},onClick:e.update,onKeyup:v(e.update,["enter"]),round:""},{default:u(()=>[Ue]),_:1},8,["onClick","onKeyup"])):C("",!0)])])])}var $e=K(z,[["render",Ie],["__scopeId","data-v-032a6fe2"]]);export{$e as default};
