import{aa as p,h as g,r as f,o as _,c as E,a,b as d,p as w,g as B,f as F}from"./vendor.7bf13f67.js";import{_ as A}from"./main.4b1474ee.js";AV;const D=p({data(){return{cloud:g.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,email:"",password:"",test:""}},setup(){},computed:{test(){return this.$store.state.islogin}},created(){AV.init({appId:"tYNddUiQgK4ghsF9PDzRiz2j-MdYXbMMI",appKey:"I3DfpmsVmqqeA66CARr0H1Br"})},mounted(){const e=new AV.Query("userinfo");e.equalTo("email",this.email),e.find().then(t=>{console.log(t)})},methods:{register(){NProgress.start();const e=this.email;/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(e)?this.cloud.auth().signUpWithEmailAndPassword(this.email,this.password).then(()=>{NProgress.done()}).catch(u=>{u&&this.$ElMessage.error("\u90AE\u7BB1\u5DF2\u5B58\u5728\uFF01"),NProgress.done()}):(alert("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E"),NProgress.done())},login(){NProgress.start(),this.cloud.auth({persistence:"local"}).signInWithEmailAndPassword(this.email,this.password).then(t=>{localStorage.setItem("yui_login_user",this.email);const u=new AV.Query("userinfo");u.equalTo("email",this.email);const i=this.cloud.database();i.command;const n=this.cloud.auth({persistence:"local"}).currentUser;i.collection("user").where({email:this.email}).get().then(o=>{if(!!o.data[0]||localStorage.getItem("uesr_auth")=="normal")return!1;i.collection("user").add({email:this.email,uauth:"1",created:Date.now(),updated:Date.now(),isEffect:"1",uid:n.uid}).then(s=>{console.log(s)})}),i.collection("user").where({email:localStorage.getItem("yui_login_user")}).get().then(o=>{const s=o.data;o.data&&(s[0].isEffect==="1"&&s[0].uauth==="0"?localStorage.setItem("user_auth","admin"):localStorage.setItem("user_auth","normal"))}),u.find().then(o=>{if(!o){const h=AV.Object.extend("userinfo"),l=new h;l.set("nickname","\u65E0\u540D\u4EBA\u58EB"),l.set("email",this.email),l.save().then(r=>{console.log(`\u4FDD\u5B58\u6210\u529F\u3002objectId\uFF1A${r.id}`)},r=>{this.$ElMessage.error("\u6570\u636E\u4FDD\u5B58\u5931\u8D25!")})}this.$ElMessage.success("\u767B\u5F55\u6210\u529F,\u8DF3\u8F6C\u4E2D...");let s=setTimeout(()=>{this.$store.commit("increment"),NProgress.done(),this.$router.push("/"),clearTimeout(s)},500);s=null})});let e=setTimeout(()=>{localStorage.getItem("yui_login_user")||(NProgress.done(),this.$ElMessage.error("\u8D26\u6237\u5BC6\u7801\u9519\u8BEF!")),clearTimeout(e)},2e3);e=null}},components:{}}),c=e=>(w("data-v-47c2d932"),e=e(),B(),e),b={class:"login-box"},I={class:"login-main boxshadow"},V=c(()=>a("h2",null,"\u767B\u5F55",-1)),v={class:"register"},$=F(" \u6CA1\u6709\u8D26\u53F7?"),y={class:"btn"},C=c(()=>a("button",null,"\u91CD\u7F6E",-1));function P(e,t,u,i,m,n){const o=f("el-input");return _(),E("div",b,[a("div",I,[V,d(o,{modelValue:e.email,"onUpdate:modelValue":t[0]||(t[0]=s=>e.email=s),placeholder:"Please input",clearable:"",class:"login-input"},null,8,["modelValue"]),d(o,{modelValue:e.password,"onUpdate:modelValue":t[1]||(t[1]=s=>e.password=s),type:"password",placeholder:"Please input password","show-password":""},null,8,["modelValue"]),a("div",v,[$,a("span",{onClick:t[2]||(t[2]=(...s)=>e.register&&e.register(...s))},"\u6CE8\u518C\u4E00\u4E0B")]),a("div",y,[a("button",{onClick:t[3]||(t[3]=(...s)=>e.login&&e.login(...s))},"\u767B\u9646"),C])])])}var q=A(D,[["render",P],["__scopeId","data-v-47c2d932"]]);export{q as default};
