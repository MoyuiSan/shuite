import{aa as P,h as j,m as d,r as u,o as p,c as k,d as y,e as v,a as s,b as i,w as a,ab as b,p as A,g as N,f as r}from"./vendor.7bf13f67.js";import{_ as R}from"./main.a3dfecda.js";const S=P({data(){return{dialogImageUrl:"",dialogVisible:!1,disabled:!1,fileList:[],radio:"\u5F71\u89C6\u5267",cloud:j.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,up:!1}},props:{type:String,shareData:Object},setup(e){return{input:d(""),input2:d(""),input3:d(""),input4:d(""),playlink:d(""),year:d("2021"),rateValue:d(null),nickname:"",user:""}},created(){this.auth=this.cloud.auth({persistence:"local"});const e=this.auth.currentUser;this.user=e,this.shareData&&(this.input=this.shareData.name,this.input2=this.shareData.link,this.input3=this.shareData.jianjie,this.input4=this.shareData.liyou,this.playlink=this.shareData.playlink,this.radio=this.shareData.class,this.rateValue=this.shareData.rateValue,this.year=this.shareData.year,this.fileList=[{name:this.shareData.name,url:this.shareData.tempFileURL,fileID:this.shareData.fileID}]),this.debouncedClick=_.debounce(this.upload,500)},unmounted(){this.debouncedClick.cancel()},methods:{handleRemove(e){this.$refs.upload.clearFiles()},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleDownload(e){console.log(e)},fileChange(e,t){this.fileList=t,console.log(t),this.up=!0},getParams(e){return e?{class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,created:Date.now(),updated:Date.now(),owner:this.user.nickName,fileID:e.fileList[0].fileID,tempFileURL:e.fileList[0].tempFileURL}:{class:this.radio,name:this.input,link:this.input2,jianjie:this.input3,liyou:this.input4,playlink:this.playlink,rateValue:this.rateValue,year:this.year,created:Date.now(),updated:Date.now(),owner:this.user.nickName}},upload(){const e=this.cloud.database(),t=this.auth.currentUser,h=e.command;e.collection("shares").where({name:this.input}).get().then(c=>{c.data.length==0?this.fileList[0]?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(g=>{let n=[];n.push(g.fileID),this.cloud.getTempFileURL({fileList:n}).then(m=>{e.collection("shares").add(this.getParams(m)).then(C=>{this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u4E0A\u4F20\u6210\u529F\u4E86!",type:"success"}),e.collection("user").where({_openid:t.uid}).update({score:h.inc(1)}).then(f=>{console.log(f)}),this.input="",this.input2="",this.input3="",this.input4="",this.playlink="",this.$refs.upload.clearFiles(),this.radio="1"})})}):this.$ElMessage.error("\u9519\u4E86\u54E6\uFF0C\u672A\u9009\u62E9\u56FE\u7247!"):this.$ElMessage.error("\u6570\u636E\u5DF2\u5B58\u5728!")})},update(){const e=this.cloud.database();this.up?this.cloud.uploadFile({cloudPath:"saosite/"+Date.now()+"."+this.fileList[0].name,filePath:this.fileList[0].raw}).then(t=>{let h=[];h.push(t.fileID),this.cloud.getTempFileURL({fileList:h}).then(c=>{console.log(c.fileList),e.collection("shares").where({_id:this.shareData._id}).update(this.getParams(c)).then(g=>{this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E86!",type:"success"});let n=[];n.push(this.shareData.fileID),console.log(n,"111"),this.cloud.deleteFile({fileList:n}).then(m=>{console.log(m.fileList)}),NProgress.done()})})}):e.collection("shares").where({_id:this.shareData._id}).update(this.getParams()).then(t=>{this.$emit("hideDialog"),this.$ElMessage.success({message:"\u606D\u559C\u4F60\uFF0C\u66F4\u65B0\u6210\u529F\u4E861!",type:"success"})})}},components:{}}),o=e=>(A("data-v-28097cc2"),e=e(),N(),e),K={class:"shares-upload"},M={key:0},z={class:"shares-upload-main"},T={class:"shares-upload-left"},q=o(()=>s("h3",{style:{}},"\u5C01\u9762(125*180)",-1)),O=["src"],G={class:"el-upload-list__item-actions",style:{display:"flex","align-items":"center"}},H=["onClick"],J=["onClick"],Q={class:"upload-left-btn"},W=r("\u91CD\u7F6E"),X=["src"],Y={class:"shares-upload-right"},Z=o(()=>s("h3",null,"\u57FA\u672C\u4FE1\u606F",-1)),x={class:"input-item"},ee=o(()=>s("span",null,"\u8BC4\u661F",-1)),te={class:"input-item-class"},se={class:"input-item"},le=o(()=>s("span",null,"\u5E74\u4EFD",-1)),ie={class:"input-item-class"},ae={class:"input-item"},ue=o(()=>s("span",null,"\u7C7B\u522B",-1)),oe={class:"input-item-div"},ne=r("\u5F71\u89C6\u5267"),de=r("\u52A8\u6F2B"),re=r("\u6E38\u620F"),pe=r("\u5176\u4ED6"),he={class:"input-item"},ce=o(()=>s("span",null,"\u540D\u79F0",-1)),me={class:"input-item"},_e=o(()=>s("span",null,"\u94FE\u63A5",-1)),fe={class:"input-item"},Fe=o(()=>s("span",null,"BV",-1)),ye={class:"input-item"},Ve=o(()=>s("span",null,"\u7B80\u4ECB",-1)),ge={class:"input-item"},De=o(()=>s("span",null,"\u7406\u7531",-1)),ke=r("\u4E0A\u4F20"),ve=r("\u66F4\u65B0");function Ce(e,t,h,c,g,n){const m=u("el-divider"),C=u("plus"),f=u("el-icon"),B=u("zoom-in"),E=u("delete"),U=u("el-upload"),D=u("el-button"),w=u("el-dialog"),L=u("el-rate"),I=u("el-date-picker"),V=u("el-radio"),F=u("el-input");return p(),k("div",K,[this.shareData?y("",!0):(p(),k("h2",M,"\u4E0A\u4F20\u5F71\u89C6")),this.shareData?y("",!0):(p(),v(m,{key:1,class:"timeline"})),s("div",z,[s("div",T,[q,i(U,{action:"#","list-type":"picture-card","auto-upload":!1,limit:1,"file-list":e.fileList,ref:"upload","on-change":e.fileChange,class:"shares-upload-img"},{default:a(()=>[i(f,null,{default:a(()=>[i(C)]),_:1})]),file:a(({file:l})=>[s("div",null,[s("img",{class:"el-upload-list__item-thumbnail",src:l.url,alt:""},null,8,O),s("span",G,[s("span",{class:"el-upload-list__item-preview",onClick:$=>e.handlePictureCardPreview(l)},[i(f,null,{default:a(()=>[i(B)]),_:1})],8,H),e.disabled?y("",!0):(p(),k("span",{key:0,class:"el-upload-list__item-delete",onClick:$=>e.handleRemove(l)},[i(f,null,{default:a(()=>[i(E)]),_:1})],8,J))])])]),_:1},8,["file-list","on-change"]),s("div",Q,[i(D,{type:"primary",style:{"margin-top":"20px"},round:""},{default:a(()=>[W]),_:1})]),i(w,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=l=>e.dialogVisible=l)},{default:a(()=>[s("img",{src:e.dialogImageUrl,alt:"",height:"300"},null,8,X)]),_:1},8,["modelValue"])]),s("div",Y,[Z,s("div",x,[ee,s("div",te,[i(L,{modelValue:e.rateValue,"onUpdate:modelValue":t[1]||(t[1]=l=>e.rateValue=l),"allow-half":""},null,8,["modelValue"])])]),s("div",se,[le,s("div",ie,[i(I,{modelValue:e.year,"onUpdate:modelValue":t[2]||(t[2]=l=>e.year=l),type:"year",placeholder:"\u9009\u62E9\u5E74"},null,8,["modelValue"])])]),s("div",ae,[ue,s("div",oe,[i(V,{modelValue:e.radio,"onUpdate:modelValue":t[3]||(t[3]=l=>e.radio=l),label:"\u5F71\u89C6\u5267"},{default:a(()=>[ne]),_:1},8,["modelValue"]),i(V,{modelValue:e.radio,"onUpdate:modelValue":t[4]||(t[4]=l=>e.radio=l),label:"\u52A8\u6F2B"},{default:a(()=>[de]),_:1},8,["modelValue"]),i(V,{modelValue:e.radio,"onUpdate:modelValue":t[5]||(t[5]=l=>e.radio=l),label:"\u6E38\u620F"},{default:a(()=>[re]),_:1},8,["modelValue"]),i(V,{modelValue:e.radio,"onUpdate:modelValue":t[6]||(t[6]=l=>e.radio=l),label:"\u5176\u4ED6"},{default:a(()=>[pe]),_:1},8,["modelValue"])])]),s("div",he,[ce,i(F,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.input,"onUpdate:modelValue":t[7]||(t[7]=l=>e.input=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),s("div",me,[_e,i(F,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.input2,"onUpdate:modelValue":t[8]||(t[8]=l=>e.input2=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),s("div",fe,[Fe,i(F,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.playlink,"onUpdate:modelValue":t[9]||(t[9]=l=>e.playlink=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),s("div",ye,[Ve,i(F,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",type:"textarea",autosize:"",modelValue:e.input3,"onUpdate:modelValue":t[10]||(t[10]=l=>e.input3=l),clearable:"",class:"film-input"},null,8,["modelValue"])]),s("div",ge,[De,i(F,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:e.input4,"onUpdate:modelValue":t[11]||(t[11]=l=>e.input4=l),type:"textarea",autosize:"",clearable:"",class:"film-input"},null,8,["modelValue"])]),e.type!=2?(p(),v(D,{key:0,type:"primary",style:{"margin-top":"20px"},onClick:e.upload,onKeyup:b(e.upload,["enter"]),round:""},{default:a(()=>[ke]),_:1},8,["onClick","onKeyup"])):y("",!0),e.type==2?(p(),v(D,{key:1,type:"primary",style:{"margin-top":"20px"},onClick:e.update,onKeyup:b(e.update,["enter"]),round:""},{default:a(()=>[ve]),_:1},8,["onClick","onKeyup"])):y("",!0)])])])}var Ee=R(S,[["render",Ce],["__scopeId","data-v-28097cc2"]]);export{Ee as default};
