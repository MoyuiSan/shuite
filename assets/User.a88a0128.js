import"./main.b607572e.js";import{d as e,i,a7 as l,a8 as o,a3 as s,a1 as n,f as t,g as a,v as u,p as d,G as r,a0 as m,Q as c,O as h,F as p,J as f,a9 as y}from"./vendor.6d187631.js";AV;const v={data:()=>({isEdit:!1,email:"",nickname:"",userid:"",cloud:e.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,relogin:!1,userinfo:[],dialogFormVisible:!1,options:[{value:"安卓",label:"安卓"},{value:"IOS",label:"IOS"}],platform:""}),setup:()=>({platform:i(""),qufu:i(""),nichen:i(""),level:i("")}),created(){this.auth=this.cloud.auth({persistence:"local"})},beforeMount(){this.auth.onLoginStateChanged((e=>{if(e){const e=this.auth.currentUser;this.email=e.email,this.nickname=e.nickName;const i=this.cloud.database();i.command,i.collection("user").where({uid:e.uid}).get().then((e=>{console.log(e.data),this.userinfo=e.data[0],this.userinfo.onmyoji&&(this.qufu=this.userinfo.onmyoji.qufu,this.platform=this.userinfo.onmyoji.platform,this.nichen=this.userinfo.onmyoji.nichen,this.level=this.userinfo.onmyoji.level)}))}else this.email="请重新获取登录信息!",this.nickname="请重新获取登录信息!",this.relogin=!0,console.log("登录失效")}))},methods:{editUser(){this.isEdit=!0},saveUser(){this.isEdit=!1;const e=this.auth.currentUser;e.update({nickName:this.nickname}).then((()=>{const i=this.cloud.database();console.log(e.uid),i.collection("user").where({_openid:e.uid}).update({nickname:this.nickname}).then((e=>{console.log(e)})),console.log("更新用户资料成功!")}))},reLogin(){this.$store.commit("noincrement")},onmyojiCertificat(){const e=this.auth.currentUser;this.cloud.database().collection("user").where({_openid:e.uid}).update({onmyoji:{qufu:this.qufu,platform:this.platfrom,nichen:this.nichen,onmyojiStus:0,level:this.level}}).then((e=>{console.log(e)}))},submitOnmyojiCertificat(){this.onmyojiCertificat(),this.dialogFormVisible=!1}},components:{}},g=y();l("data-v-6cd82ac2");const b={key:0,class:"user-box"},k={class:"userinfo boxshadow"},j=a("h3",null,"个人信息",-1),V=a("img",{src:"https://q1.qlogo.cn/g?b=qq&nk=1193292553&s=640",width:"80",height:"80"},null,-1),U={class:"user-item"},q=a("span",null,"昵称:",-1),x={key:0},C={class:"user-item"},w=a("span",null,"阴阳师:",-1),E={key:1,class:"onmyoji-modify"},_=a("div",{class:"onmyoji-mes"},"已认证",-1),F={class:"onmyoji-mes"},L={class:"user-item"},O=a("span",null,"积分:",-1),S={class:"user-item"},I=a("span",null,"账号状态:",-1),N={class:"user-item"},A=a("span",null,"账号状态:",-1),G={class:"user-item"},J=a("span",null,"邮箱:",-1),M={class:"onmyoji-apply"},Q={class:"dialog-footer"},$=c("取 消"),z=c("确 定");o();const B=g(((e,i,l,o,y,v)=>{const B=s("el-option"),D=s("el-select"),H=s("el-input"),K=s("el-button"),P=s("el-dialog");return n(),t(p,null,[y.userinfo.onmyoji?(n(),t("div",b,[a("div",k,[j,V,a("div",U,[q,y.isEdit?d("",!0):(n(),t("span",x,u(y.nickname),1)),y.isEdit?r((n(),t("input",{key:1,type:"text",placeholder:"请输入你的昵称","onUpdate:modelValue":i[1]||(i[1]=e=>y.nickname=e)},null,512)),[[m,y.nickname]]):d("",!0)]),a("div",C,[w,y.userinfo.onmyoji?d("",!0):(n(),t("span",{key:0,class:"onmyoji-certification",onClick:i[2]||(i[2]=e=>y.dialogFormVisible=!0)},"未认证")),y.userinfo.onmyoji?(n(),t("div",E,[_,a("div",F,[a("label",null,"Lv."+u(y.userinfo.onmyoji.level),1),c(u(y.userinfo.onmyoji.nichen),1)])])):d("",!0)]),a("div",L,[O,a("span",null,u(y.userinfo.score),1)]),a("div",S,[I,a("span",null,u("1"==y.userinfo.isEffect?"已生效":"未生效"),1)]),a("div",N,[A,a("span",null,u("1"==y.userinfo.uauth?"普通用户":"核心用户"),1)]),a("div",G,[J,a("span",null,u(y.email),1)]),y.isEdit?d("",!0):r((n(),t("button",{key:0,onClick:i[3]||(i[3]=(...e)=>v.editUser&&v.editUser(...e))},"编辑",512)),[[h,!y.relogin]]),y.isEdit?(n(),t("button",{key:1,onClick:i[4]||(i[4]=(...e)=>v.saveUser&&v.saveUser(...e))},"保存")):d("",!0),y.isEdit?d("",!0):r((n(),t("button",{key:2,onClick:i[5]||(i[5]=(...e)=>v.reLogin&&v.reLogin(...e))},"获取",512)),[[h,y.relogin]])])])):d("",!0),a(P,{title:"申请信息",modelValue:y.dialogFormVisible,"onUpdate:modelValue":i[11]||(i[11]=e=>y.dialogFormVisible=e)},{footer:g((()=>[a("span",Q,[a(K,{onClick:i[10]||(i[10]=e=>y.dialogFormVisible=!1)},{default:g((()=>[$])),_:1}),a(K,{type:"primary",onClick:v.submitOnmyojiCertificat},{default:g((()=>[z])),_:1},8,["onClick"])])])),default:g((()=>[a("div",M,[a(D,{modelValue:o.platform,"onUpdate:modelValue":i[6]||(i[6]=e=>o.platform=e),placeholder:"请选择",style:{"margin-bottom":"20px",width:"250px"}},{default:g((()=>[(n(!0),t(p,null,f(y.options,(e=>(n(),t(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),a(H,{modelValue:o.qufu,"onUpdate:modelValue":i[7]||(i[7]=e=>o.qufu=e),placeholder:"请输入区服",style:{"margin-bottom":"20px",width:"250px"}},null,8,["modelValue"]),a(H,{modelValue:o.nichen,"onUpdate:modelValue":i[8]||(i[8]=e=>o.nichen=e),placeholder:"请输入昵称",style:{"margin-bottom":"20px",width:"250px"}},null,8,["modelValue"]),a(H,{modelValue:o.level,"onUpdate:modelValue":i[9]||(i[9]=e=>o.level=e),placeholder:"请输入等级",style:{"margin-bottom":"20px",width:"250px"}},null,8,["modelValue"])])])),_:1},8,["modelValue"])],64)}));v.render=B,v.__scopeId="data-v-6cd82ac2";export default v;
