import"./main.96d3c66c.js";import{v as a,a9 as t,d as e,a7 as s,a8 as o,a3 as i,a1 as l,f as c,g as d,p as n,F as h,J as m,G as r,a0 as u}from"./vendor.6d187631.js";const g={data:()=>({filmName:""}),props:["filmid"],created(){const a=this.$cloudbase.database();a.command,a.collection("films").where({_id:this.filmid}).get().then((a=>{console.log(a),this.filmName=a.data[0].name}))},components:{}},p=t()(((t,e,s,o,i,l)=>a(i.filmName)));g.render=p,g.__scopeId="data-v-7f98bfb0";AV;const f={data:()=>({ishowChat:!1,tucao:"",dataChat:[],cloud:e.init({env:"yui-7gel1hqtaf6fb79d"}),auth:null,nickname:"匿名用户",email:"2717902644@qq.com",userAuth:!!localStorage.getItem("user_auth"),loading:!0}),created(){this.auth=this.cloud.auth({persistence:"local"}),this.debouncedClick=_.debounce(this.tuCao,500)},unmounted(){this.debouncedClick.cancel()},components:{},computed:{},mounted(){this.auth.onLoginStateChanged((a=>{a?console.log(localStorage):console.log("登录失效")})),AV.init({appId:"tYNddUiQgK4ghsF9PDzRiz2j-MdYXbMMI",appKey:"I3DfpmsVmqqeA66CARr0H1Br"}),NProgress.start(),this.dataTucao()},methods:{showChat(){this.ishowChat?this.ishowChat=!1:this.ishowChat=!0},dataTucao(){const a=this.$cloudbase.database();a.command,a.collection("chats").orderBy("created","desc").limit(10).get().then((a=>{NProgress.done(),console.log(a.data),this.dataChat=a.data,this.loading=!1}))},tuCao(){new AV.Query("tucao");const a=new(AV.Object.extend("tucao"));a.set("nickname",this.nickname),a.set("chat",this.tucao),a.set("email",this.email),a.save().then((a=>{console.log(`保存成功。objectId：${a.id}`),this.ishowChat=!1,this.dataTucao()}),(a=>{}))},formaTime:a=>moment(a).startOf("hour").fromNow(),deleteChat(a){AV.Object.createWithoutData("tucao",a).destroy();let t=setTimeout((()=>{this.dataTucao(),clearTimeout(t)}),500);t=null}},components:{"chat-from":g}},b=t();s("data-v-1bfe222e");const C={style:{"margin-top":"60px"}},w={class:"chat"},k={class:"msg"},v={class:"msg-item",style:{"background-color":"#faa"}},y={class:"msg-item"},q={class:"msg-item"};o();const x=b(((t,e,s,o,g,p)=>{const f=i("lottie-player"),x=i("chat-from"),I=i("router-link");return l(),c(h,null,[d("h3",C,"最新留言("+a(g.dataChat.length)+")",1),d("div",w,[g.loading?(l(),c(f,{key:0,src:"https://assets1.lottiefiles.com/packages/lf20_gmswat4t.json",background:"transparent",speed:"1",style:{width:"300px",height:"300px",color:"black"},loop:"",autoplay:""})):n("",!0),g.loading?n("",!0):(l(!0),c(h,{key:1},m(g.dataChat,((t,e)=>(l(),c("div",{class:"chatbox boxshadow",key:e,"data-scrollreveal":""},[d("img",{src:"https://q1.qlogo.cn/g?b=qq&nk="+t.email+"&s=640",width:"50",height:"50"},null,8,["src"]),d("div",k,[d("div",v,a(t.nickname),1),d(I,{to:{name:"filmdetail",params:{id:t.filmId}}},{default:b((()=>[d("div",y,[d(x,{filmid:t.filmId},null,8,["filmid"])])])),_:2},1032,["to"]),d("div",q,a(p.formaTime(t.created)),1)]),d("p",null,a(t.chat),1)])))),128)),d("div",{class:{writechat:!0,showchat:g.ishowChat}},[r(d("input",{type:"text",placeholder:"吐槽一下吧",size:"30",maxlength:"50","onUpdate:modelValue":e[1]||(e[1]=a=>g.tucao=a)},null,512),[[u,g.tucao]]),d("i",{class:"fas fa-feather-alt",onClick:e[2]||(e[2]=(...a)=>p.tuCao&&p.tuCao(...a))})],2)])],64)}));f.render=x,f.__scopeId="data-v-1bfe222e";export default f;
