import{_ as e}from"./FilmsBox.a9c88f7f.js";import a from"./FilmsUpload.2bce8f0c.js";import{a7 as l,a8 as t,a1 as i,f as s,F as o,J as n,g as c,v as d,a9 as m,a3 as r,Q as h,i as u,p as f}from"./vendor.6d187631.js";import"./ShuiteInput.49482935.js";import{_ as p}from"./main.65675ec6.js";const g={data:()=>({email:"1193292553@qq.com",filmDetail:{}}),created(){const e=this.$cloudbase.database();e.command,e.collection("chats").where({_id:this.filmid,chatFrom:"film"}).get().then((e=>{this.filmDetail=e.data,console.log(e.data)}))},methods:{formaTime:e=>moment(e).startOf("hour").fromNow()},components:{}},v=m();l("data-v-454781fa");const b={class:"film-chats boxshadow"},y=c("h3",null,"评论",-1),D={class:"chat-box"},_={class:"chat-box-message"},k=c("span",null,"来自快乐星球",-1),x={class:"message"};t();const w=v(((e,a,l,t,m,r)=>(i(),s("div",b,[y,(i(!0),s(o,null,n(m.filmDetail,(e=>(i(),s("div",D,[c("img",{src:"https://q1.qlogo.cn/g?b=qq&nk="+e.email+"&s=640"},null,8,["src"]),c("div",_,[c("p",null,d(e.nickname),1),c("p",null,[k,c("span",null,d(r.formaTime(e.created)),1)]),c("div",x,d(e.chat),1)])])))),256))]))));g.render=w,g.__scopeId="data-v-454781fa";const V={data:()=>({input:""}),props:["filmid"],methods:{submitChat(){const e=this.$auth.currentUser,a=this.$cloudbase.database();a.command,a.collection("chats").add({filmId:this.filmid,chatFrom:"film",chat:this.input,nickname:e.nickName,appVersion:navigator.appVersion,email:e.email,created:Date.now(),updated:Date.now()}).then((e=>{this.$emit("nochat"),this.$ElMessage.success({message:"吐槽成功了!",type:"success"})}))}},components:{}},C=m();l("data-v-b58c3f26");const S={class:"film-gochat boxshadow"},j=h("提交");t();const F=C(((e,a,l,t,o,n)=>{const d=r("el-input"),m=r("el-button");return i(),s("div",S,[c(d,{placeholder:"吐槽一下吧",modelValue:o.input,"onUpdate:modelValue":a[1]||(a[1]=e=>o.input=e),clearable:"",class:"shuite-search"},null,8,["modelValue"]),c(m,{onClick:n.submitChat,type:"small",style:{height:"40px","margin-left":"10px"}},{default:C((()=>[j])),_:1},8,["onClick"])])}));V.render=F,V.__scopeId="data-v-b58c3f26";const I={data:()=>({loading:!0,post:null,error:null,cloud:cloudbase.init({env:"yui-7gel1hqtaf6fb79d"}),dialogTableVisible:!1,userAuth:localStorage.getItem("user_auth"),isLoved:!1,textareaStyle:{border:0,padding:0,color:"black"},chating:!1}),setup:e=>({filmsDetail:u(""),nickname:u("")}),created(){this.cloud.auth({persistence:"local"}),this.getFilmDetail(),console.log(JSON.parse(localStorage.getItem("login_type_yui-7gel1hqtaf6fb79d")).content,"111")},methods:{formatterTime:(e,a,l,t)=>moment(l).format("YYYY/MM/DD"),formatterTimeYear:(e,a,l,t)=>moment(e).format("YYYY"),getFilmDetail(){this.$auth.getAuthHeader();const e=this.cloud.database();e.command,e.collection("films").where({_id:this.$route.params.id}).orderBy("created","desc").limit(1).get().then((a=>{this.filmsDetail=a.data[0],e.collection("user").where({_openid:this.filmsDetail._openid}).get().then((a=>{this.nickname=a.data[0].nickname,e.collection("mylove").where({_openid:this.filmsDetail._openid,filmId:this.filmsDetail._id}).get().then((e=>{e.data[0]&&(this.isLoved=!0),setTimeout((()=>{this.loading=!1}),1e3)}))}))}))},getStar(e){const a=this.$auth.getAuthHeader(),l=this.$cloudbase.database();l.command;"ANONYMOUS"==JSON.parse(localStorage.getItem("login_type_yui-7gel1hqtaf6fb79d")).content?p.info("请先登录哦!!!"):l.collection("mylove").where({_openid:a.uid,filmId:e}).get().then((a=>{a.data[0]||l.collection("mylove").add({filmId:e,created:Date.now(),updated:Date.now()}).then((e=>{console.log(e),this.getFilmDetail(),p.success({message:"收藏成功了!",type:"success"})}))}))},delStar(e){const a=this.$auth.getAuthHeader(),l=this.$cloudbase.database();l.command,l.collection("mylove").where({_openid:a.uid,filmId:e}).remove().then((e=>{this.getFilmDetail(),p.success({message:"取消收藏了!",type:"success"})}))},toChat(){this.chating=!0},noChat(){this.chating=!1},hideDialog(){this.dialogTableVisible=!1,this.getFilmDetail()}},components:{FilmsBox:e,"films-upload":a,"film-chats":g,"film-gochat":V}},T=m();l("data-v-3c98211e");const Y={class:"filmdetail"},$={style:{padding:"14px"}},q={style:{display:"flex","align-items":"center","justify-items":"space-between","margin-top":"16px",height:"16px"}},N={class:"film-box"},U={class:"film-top"},A={class:"film-message"},H={class:"name"},L=c("span",null,"名称:",-1),O={class:"fclass"},M=c("span",null,"类型:",-1),B={class:"jianjie"},J=c("span",null,"年份:",-1),z={class:"upload-time"},E=c("span",null,"上传时间:",-1),Q={class:"upload-owner"},R=c("span",null,"上传者:",-1),G={class:"rate",style:{display:"flex"}},K=c("span",null,"评分:",-1),P={class:"film-btn"},W=c("i",{class:"el-icon-link"},null,-1),X={class:"film-main"},Z=c("h3",null,"简介",-1),ee=c("h3",null,"推荐理由",-1);t();const ae=T(((e,a,l,t,n,m)=>{const u=r("el-skeleton-item"),p=r("el-rate"),g=r("film-gochat"),v=r("el-input"),b=r("film-chats"),y=r("el-skeleton"),D=r("el-space"),_=r("films-upload"),k=r("el-dialog");return i(),s(o,null,[c("div",Y,[c(D,{direction:"vertical",alignment:"flex-start",class:"shuite-el-space"},{default:T((()=>[c(y,{rows:15,animated:"",loading:n.loading,class:"shuite-el-skeleton"},{template:T((()=>[c(u,{variant:"image",style:{height:"267px"},class:"shuite-el-skeleton-item"}),c("div",$,[c(u,{variant:"h3",style:{width:"50%"}}),c("div",q,[c(u,{variant:"text",style:{"margin-right":"16px"}}),c(u,{variant:"text",style:{width:"30%"}})])])])),default:T((()=>[c("div",N,[c("div",U,[t.filmsDetail?(i(),s("img",{key:0,src:t.filmsDetail.tempFileURL},null,8,["src"])):f("",!0),c("div",A,[c("div",H,[L,h(d(t.filmsDetail.name),1)]),c("div",O,[M,h(d(t.filmsDetail.class),1)]),c("div",B,[J,h(d(m.formatterTimeYear(t.filmsDetail.year)),1)]),c("div",z,[E,h(d(m.formatterTime(t.filmsDetail.created)),1)]),c("div",Q,[R,h(d(t.nickname),1)]),c("div",G,[K,c(p,{"model-value":t.filmsDetail.rateValue,"allow-half":"",disabled:""},null,8,["model-value"])])])]),c("div",P,[c("a",{href:t.filmsDetail.link,target:"_blank"},[W],8,["href"]),n.isLoved?f("",!0):(i(),s("i",{key:0,class:"el-icon-star-off",onClick:a[1]||(a[1]=e=>m.getStar(t.filmsDetail._id))})),n.isLoved?(i(),s("i",{key:1,class:"el-icon-star-on",onClick:a[2]||(a[2]=e=>m.delStar(t.filmsDetail._id)),style:{color:"#fcc"}})):f("",!0),c("i",{class:"el-icon-chat-square",onClick:a[3]||(a[3]=(...e)=>m.toChat&&m.toChat(...e))}),"admin"==n.userAuth?(i(),s("i",{key:2,class:"el-icon-edit",onClick:a[4]||(a[4]=e=>n.dialogTableVisible=!0)})):f("",!0)]),n.chating?(i(),s(g,{key:0,filmid:t.filmsDetail._id,onNochat:m.noChat},null,8,["filmid","onNochat"])):f("",!0),c("div",X,[Z,c(v,{type:"textarea",modelValue:t.filmsDetail.jianjie,"onUpdate:modelValue":a[5]||(a[5]=e=>t.filmsDetail.jianjie=e),autosize:"",readonly:"",resize:"none",autofocus:"false",style:{"margin-bottom":"20px"},"input-style":n.textareaStyle},null,8,["modelValue","input-style"]),ee,c("p",null,d(t.filmsDetail.liyou),1)]),c(b)])])),_:1},8,["loading"])])),_:1})]),c(k,{title:"信息修改",modelValue:n.dialogTableVisible,"onUpdate:modelValue":a[6]||(a[6]=e=>n.dialogTableVisible=e),top:"5vh",fullscreen:""},{default:T((()=>[c(_,{type:"2",filmsData:t.filmsDetail,onHideDialog:m.hideDialog},null,8,["filmsData","onHideDialog"])])),_:1},8,["modelValue"])],64)}));I.render=ae,I.__scopeId="data-v-3c98211e";export default I;
